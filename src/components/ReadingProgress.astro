---
interface Props {
  readingTime: string
}

const { readingTime } = Astro.props
---

<!-- Circular Progress Indicator (bottom right) -->
<div id="reading-progress-circle" class="fixed bottom-6 right-6 z-50 opacity-0 transition-opacity duration-300">
  <div class="relative w-12 h-12">
    <svg class="w-full h-full transform -rotate-90" viewBox="0 0 36 36">
      <!-- Background circle -->
      <circle 
        cx="18" cy="18" r="16" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="2"
        class="text-muted/30"
      />
      <!-- Progress circle -->
      <circle 
        id="progress-circle"
        cx="18" cy="18" r="16" 
        fill="none" 
        stroke="currentColor" 
        stroke-width="2.5"
        stroke-linecap="round"
        stroke-dasharray="100.53"
        stroke-dashoffset="100.53"
        class="text-foreground transition-all duration-150"
      />
    </svg>
    <!-- Percentage text in center -->
    <span id="progress-text" class="absolute inset-0 flex items-center justify-center text-xs font-mono font-bold">0%</span>
  </div>
</div>

<script>
  document.addEventListener('astro:page-load', () => {
    const progressContainer = document.getElementById('reading-progress-circle')
    const progressCircle = document.getElementById('progress-circle')
    const progressText = document.getElementById('progress-text')
    
    if (!progressContainer || !progressCircle || !progressText) return
    
    const article = document.querySelector('article.prose')
    if (!article) return
    
    const circumference = 2 * Math.PI * 16 // r=16
    
    const updateProgress = () => {
      const articleRect = article.getBoundingClientRect()
      const articleTop = articleRect.top + window.scrollY
      const articleHeight = articleRect.height
      const windowHeight = window.innerHeight
      const scrolled = window.scrollY - articleTop + windowHeight * 0.3
      
      let progress = Math.max(0, Math.min(100, (scrolled / articleHeight) * 100))
      
      // Show/hide based on scroll position
      if (window.scrollY > 200) {
        progressContainer.classList.remove('opacity-0')
        progressContainer.classList.add('opacity-100')
      } else {
        progressContainer.classList.add('opacity-0')
        progressContainer.classList.remove('opacity-100')
      }
      
      // Update circular progress
      const offset = circumference - (progress / 100) * circumference
      progressCircle.style.strokeDashoffset = offset.toString()
      
      // Update text
      progressText.textContent = `${Math.round(progress)}%`
    }
    
    let ticking = false
    window.addEventListener('scroll', () => {
      if (!ticking) {
        requestAnimationFrame(() => {
          updateProgress()
          ticking = false
        })
        ticking = true
      }
    })
    
    updateProgress()
  })
</script>
